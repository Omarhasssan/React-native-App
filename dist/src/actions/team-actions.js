Object.defineProperty(exports,"__esModule",{value:true});exports.setTeamPlayers=exports.setTeamName=exports.onTeamHasNewPlayer=exports.getTeam=exports.createTeamWithSendingRequests=exports.getTeams=undefined;var _this=this;var _helpers=require('../helpers');var _userActions=require('./user-actions');var _=require('.');var _firebase=require('../config/firebase');var _firebase2=_interopRequireDefault(_firebase);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var getTeams=exports.getTeams=function getTeams(){return function(dispatch){_helpers.DBHelpers.getTeams().then(function(teams){dispatch({type:'TEAMS',teams:teams});});};};var createTeamWithSendingRequests=exports.createTeamWithSendingRequests=function createTeamWithSendingRequests(user,teamName,playersId,socket){return function(dispatch){var team={name:teamName,records:{wins:0,losses:0,draws:0,gamesPlayed:0,goals:0}};_helpers.DBHelpers.addTeam(team);dispatch({type:'ADD_TEAM',team:team});dispatch({type:'CREATE_ROOM_BY_TEAM_ID',id:team.id});dispatch((0,_userActions.updateUserTeam)(user.id,team.id));dispatch((0,_userActions.updateUserRoleToCaptain)(user));dispatch((0,_.sendJoiningTeamRequest)(team,playersId,socket));};};var getTeam=exports.getTeam=function getTeam(teamId){return function(dispatch){dispatch({type:'GET_TEAM',teamId:teamId});};};var onTeamHasNewPlayer=exports.onTeamHasNewPlayer=function onTeamHasNewPlayer(){return function _callee2(dispatch){var teams,teamsLen,cnt,first;return regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return regeneratorRuntime.awrap(_helpers.DBHelpers.getTeams());case 2:teams=_context2.sent;teamsLen=teams.length;cnt=0;first=true;_firebase2.default.database().ref('teams').on('child_added',function(team){cnt++;if(cnt>teamsLen)first=false;team=team.toJSON();_firebase2.default.database().ref('teams'+'/'+team.id+'/'+'players').on('child_added',function _callee(playerId){var updatedTeam,player;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:updatedTeam={};if(first){_context.next=6;break;}_context.next=4;return regeneratorRuntime.awrap(_helpers.DBHelpers.getUserById(playerId.toJSON()));case 4:player=_context.sent;dispatch({type:'UPDATE_TEAM_PLAYERS',payload:{teamId:team.id,player:player}});case 6:case'end':return _context.stop();}}},null,_this);});});case 7:case'end':return _context2.stop();}}},null,_this);};};var setTeamName=exports.setTeamName=function setTeamName(teamName){return function(dispatch){dispatch({type:'SET_TEAM_NAME',teamName:teamName});};};var setTeamPlayers=exports.setTeamPlayers=function setTeamPlayers(teamPlayers){return function(dispatch){dispatch({type:'SET_TEAM_PLAYERS',teamPlayers:teamPlayers});};};