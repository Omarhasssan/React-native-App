Object.defineProperty(exports,"__esModule",{value:true});exports.acceptRequest=exports.getUserRequest=exports.saveAndSendObservingRequest=exports.removeObservingRequest=exports.sendJoiningTeamRequest=undefined;var _this=this;var _helpers=require('../helpers');var _actions=require('../actions');var sendJoiningTeamRequest=exports.sendJoiningTeamRequest=function sendJoiningTeamRequest(team,playersId,socket){return function(dispatch){playersId.map(function _callee2(playerId){var DBRequest;return regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:DBRequest={teamId:team.id,playerId:playerId,status:'PENDING'};_helpers.DBHelpers.addTeamRequest(DBRequest).then(function _callee(reqId){var req;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=reqId;_context.t1=team;_context.next=4;return regeneratorRuntime.awrap(_helpers.DBHelpers.getUserById(playerId));case 4:_context.t2=_context.sent;req={id:_context.t0,type:'joinTeam',team:_context.t1,player:_context.t2,status:'PENDING'};dispatch(socket.emit('sendRequest',{userId:playerId,request:req}));case 7:case'end':return _context.stop();}}},null,_this);});case 2:case'end':return _context2.stop();}}},null,_this);});};};var removeObservingRequest=exports.removeObservingRequest=function removeObservingRequest(roomId,observerId,socket){return function(dispatch){_helpers.DBHelpers.getObservingRequest(roomId,observerId).then(function(req){_helpers.DBHelpers.removeObservingRequest(req.id);socket.emit('removeRequest',{userId:observerId,request:{id:req.id,type:'observing'}});});};};var saveAndSendObservingRequest=exports.saveAndSendObservingRequest=function saveAndSendObservingRequest(room,observerId,socket){return function(dispatch){var DBRequest={playerId:observerId,roomId:room.id,status:'PENDING'};_helpers.DBHelpers.addObservingRequest(DBRequest).then(function(reqId){var Request={id:reqId,status:'PENDING',room:room,playerId:observerId};socket.emit('sendRequest',{userId:observerId,request:Request});});};};var getUserRequest=exports.getUserRequest=function getUserRequest(socket,user){return function(dispatch){_helpers.DBHelpers.getUserRequest(user.id).then(function(userRequests){dispatch({type:'USER_REQUESTS',userReqs:userRequests});});socket.on('removeRequest',function(request){if(request.type=='observing'){dispatch({type:'REMOVE_OBSERVING_REQUEST',requestId:request.id});}});socket.on('requests',function(request){if(request.type=='joinTeam')dispatch({type:'ADD_TEAM_REQUEST',request:request});else dispatch({type:'ADD_OBSERVING_REQUEST',request:request});});};};var acceptRequest=exports.acceptRequest=function acceptRequest(request,socket){return function(dispatch){console.log('req',request);if(request.type=='joinTeam')dispatch({type:'ACCEPT_TEAM_REQUEST',requestId:request.id});else{fetch('https://us-central1-squad-builder.cloudfunctions.net/req/acceptObservingRoom',{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify(request)}).then(function(res){console.log('res');});}};};