Object.defineProperty(exports,"__esModule",{value:true});exports.requestsService=undefined;var _firebase=require('../config/firebase');var _firebase2=_interopRequireDefault(_firebase);var _Service=require('../Service');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var _=require('lodash');var requestsService=exports.requestsService={getUserRequest:getUserRequest,updateRequest:updateRequest};function getTeamRequests(userId){var _this=this;var teamRequests=[];return new Promise(function(resolve,reject){_firebase2.default.database().ref('TeamRequests').once('value',function _callee(snapshot){var reqs,newReq;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:reqs=snapshot.toJSON();_context.t0=regeneratorRuntime.keys(reqs);case 2:if((_context.t1=_context.t0()).done){_context.next=18;break;}index=_context.t1.value;newReq={};if(!(reqs[index].playerId==userId&&reqs[index].status=='PENDING')){_context.next=16;break;}_context.next=8;return regeneratorRuntime.awrap(_Service.teamsService.getTeamById(reqs[index].teamId));case 8:newReq.team=_context.sent;newReq.status=reqs[index].status;newReq.type='joinTeam';_context.next=13;return regeneratorRuntime.awrap(_Service.usersService.getUserById(reqs[index].playerId));case 13:newReq.player=_context.sent;newReq.id=reqs[index].id;teamRequests.push(newReq);case 16:_context.next=2;break;case 18:case'end':return _context.stop();}}},null,_this);});});}function getUserRequest(userId){var _this2=this;var arr={teamRequests:[],observingRequests:[]};return new Promise(function(resolve,reject){return _firebase2.default.database().ref('TeamRequests').once('value',function _callee2(snapshot){var reqs,newReq;return regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:reqs=snapshot.toJSON();_context2.t0=regeneratorRuntime.keys(reqs);case 2:if((_context2.t1=_context2.t0()).done){_context2.next=18;break;}index=_context2.t1.value;newReq={};if(!(reqs[index].playerId==userId&&reqs[index].status=='PENDING')){_context2.next=16;break;}_context2.next=8;return regeneratorRuntime.awrap(_Service.teamsService.getTeamById(reqs[index].teamId));case 8:newReq.team=_context2.sent;newReq.status=reqs[index].status;newReq.type='joinTeam';_context2.next=13;return regeneratorRuntime.awrap(_Service.usersService.getUserById(reqs[index].playerId));case 13:newReq.player=_context2.sent;newReq.id=reqs[index].id;arr.teamRequests.push(newReq);case 16:_context2.next=2;break;case 18:case'end':return _context2.stop();}}},null,_this2);}).then(function(){return _firebase2.default.database().ref('ObservingRequests').once('value',function _callee3(snapshot){var reqs,newReq;return regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:reqs=snapshot.toJSON();_context3.t0=regeneratorRuntime.keys(reqs);case 2:if((_context3.t1=_context3.t0()).done){_context3.next=18;break;}index=_context3.t1.value;newReq={};if(!(reqs[index].playerId==userId&&reqs[index].status=='PENDING')){_context3.next=16;break;}_context3.next=8;return regeneratorRuntime.awrap(_Service.roomsService.getRoomById(reqs[index].roomId));case 8:newReq.room=_context3.sent;newReq.status=reqs[index].status;newReq.type='observing';_context3.next=13;return regeneratorRuntime.awrap(_Service.usersService.getUserById(reqs[index].playerId));case 13:newReq.player=_context3.sent;newReq.id=reqs[index].id;arr.observingRequests.push(newReq);case 16:_context3.next=2;break;case 18:case'end':return _context3.stop();}}},null,_this2);}).then(function(){resolve(arr);});});});}function updateRequest(requestId,reqType){if(reqType=='joinTeam'){return _firebase2.default.database().ref('TeamRequests'+'/'+requestId+'/'+'status').set('ACCEPTED');}return _firebase2.default.database().ref('ObservingRequests'+'/'+requestId+'/'+'status').set('ACCEPTED');}